<script src="/socket.io/socket.io.js"></script>
<script type="text/javascript">
var socket = io.connect(window.location.href);
socket.on('connect', function(msg) {
  console.log("connet");
/*  document.getElementById("connectId").innerHTML = 
    "あなたの接続ID::" + socket.socket.transport.sessid;
  document.getElementById("type").innerHTML = 
    "接続方式::" + socket.socket.transport.name;*/
});

// メッセージを受けたとき
socket.on('message', function(msg) {
  // メッセージを画面に表示する
	$("#content").append(msg.value);
	$(".post_article:hidden").fadeIn("1500");
	var e = document.getElementById("content");
	e.scrollTop = e.scrollHeight;
});

// メッセージを送る
function SendMsg() {
	var name = document.getElementById("name").value;
	var comment = document.getElementById("comment").value;
	var mode;
	for(var i=0; i<document.formname.mode.length; i++){
		if(document.formname.mode[i].checked) mode = i;
	}
	// メッセージを発射する
	var msg;
	myTbl     = new Array("日","月","火","水","木","金","土");
	myD       = new Date();

	myYear    = myD.getYear()
	myYear4   = (myYear < 2000) ? myYear+1900 : myYear;
	myMonth   = myD.getMonth() + 1;
	myDate    = myD.getDate();
	myDay     = myD.getDay();
	myHours   = myD.getHours();
	myMinutes = myD.getMinutes();
	mySeconds = myD.getSeconds();

	myMess1   = myYear4 + "年" + myMonth + "月" + myDate + "日";
	myMess2   = "("+myTbl[myDay] + ")";
	myMess3   = myHours + "時" + myMinutes + "分" + mySeconds + "秒";
	date    = myMess1 + " " + myMess2 + " " + myMess3;
	
	if(mode==1){
		var eq=comment.replace(/¥/g,"\\");
		msg='<div class="post_article"><div class="content-name">'+name+': '+date+'</div><div class="content-body"><img src="http://chart.apis.google.com/chart?cht=tx&chs=1x0&chf=bg,s,FFFFFF&chco=000000&chl='+encodeURIComponent(eq)+'" alt="equation" /></div></div>';
	}else{
		msg='<div class="post_article"><div class="content-name">'+name+': '+date+'</div><div class="content-body">'+comment+"</div></div>";
	}
	socket.emit('message', { value: msg });
}
// 切断する
function DisConnect() {
  var msg = socket.socket.transport.sessid + "は切断しました。";
  // メッセージを発射する
  socket.emit('message', { value: msg });
  // socketを切断する
  socket.disconnect();
}
</script>
<div id="content" class="grid_12"></div>
<div class="clear"></div>
<br>
<form name="formname">
<input name="id" type="hidden" value="<?php echo $id; ?>">
　Name: <input id="name" name="name" type="text" /><br />
　Mode: <input name="mode" type="radio" value="0" checked/>text
<input name="mode" type="radio" value="1" />equation
<input name="mode" type="radio" value="2" />figure<br />
　Content:<br />
 <textarea id="comment" name="content" cols="100" rows="5"></textarea><br />
　<input id="submit_btn" type="button" value="submit" onclick="SendMsg()" />
　<input id="reset_btn" type="reset" value="reset" /><br/>
</form>
<div id="receiveMsg"></div>